generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Customer {
  id                       String                @id @default(cuid())
  firstName                String
  lastName                 String
  phoneNumber              String                @unique
  email                    String
  birthDate                DateTime?
  city                     String?
  street                   String?
  postalCode               String?
  houseNumber              String?
  preferredFood            String?
  feedback                 String?
  country                  String?
  discountCode             String                @unique
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  emailVerificationCode    String?
  isEmailVerified          Boolean               @default(false)
  lastBirthdayGreetingSent DateTime?
  subscriptions            MessageSubscription[]
  marketingConsent         Boolean               @default(false)
}

model Owner {
  id                    String              @id @default(cuid())
  email                 String              @unique
  name                  String
  accessCode            String              @unique
  password              String
  isActive              Boolean             @default(true)
  lastLogin             DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  emailVerificationCode String?
  isEmailVerified       Boolean             @default(false)
  loginSessions         OwnerLoginSession[]
}

model MessageSubscription {
  id         String            @id @default(cuid())
  customerId String
  subscribed Boolean           @default(true)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  deliveries MessageDelivery[]
  customer   Customer          @relation(fields: [customerId], references: [id])
}

model BroadcastMessage {
  id           String            @id @default(cuid())
  title        String
  body         String
  createdAt    DateTime          @default(now())
  scheduledFor DateTime?
  deliveries   MessageDelivery[]
}

model MessageDelivery {
  id             String              @id @default(cuid())
  messageId      String
  subscriptionId String
  phoneNumber    String
  status         DeliveryStatus      @default(PENDING)
  sentAt         DateTime?
  errorMessage   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  message        BroadcastMessage    @relation(fields: [messageId], references: [id])
  subscription   MessageSubscription @relation(fields: [subscriptionId], references: [id])
}

model OwnerLoginSession {
  id                String   @id @default(cuid())
  ownerId           String
  deviceInfo        String?
  ipAddress         String?
  location          String?
  userAgent         String?
  browser           String?
  os                String?
  device            String?
  country           String?
  city              String?
  latitude          Float?
  longitude         Float?
  isSuccessful      Boolean  @default(true)
  loginAt           DateTime @default(now())
  timezone          String?
  isp               String?
  region            String?
  deviceType        String?
  deviceModel       String?
  browserName       String?
  browserVersion    String?
  osName            String?
  osVersion         String?
  countryCode       String?
  regionCode        String?
  postal            String?
  currency          String?
  currencyName      String?
  languages         String?
  countryPopulation Int?
  countryArea       Int?
  countryCapital    String?
  continent         String?
  isEu              Boolean?
  callingCode       String?
  utcOffset         String?
  owner             Owner    @relation(fields: [ownerId], references: [id])
}

model FormDraft {
  id            String   @id @default(cuid())
  firstName     String?
  lastName      String?
  phoneNumber   String?
  email         String?
  city          String?
  street        String?
  postalCode    String?
  houseNumber   String?
  country       String?
  preferredFood String?
  feedback      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ProductCategory {
  id       String    @id @default(cuid())
  name     String    @unique
  products Product[]
}

model Product {
  id          Int             @id @default(autoincrement())
  name        String
  description String?
  price       Float
  imageUrl    String?
  categoryId  String
  category    ProductCategory @relation(fields: [categoryId], references: [id])
}

enum DeliveryStatus {
  PENDING
  SENT
  FAILED
}
